<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>Storico Errori</title>
</head>
<script>

async function getIP() {
    const savedValue = localStorage.getItem('userInput');
    if (savedValue) {
        console.log(`Valore recuperato: ${savedValue}`);
        return savedValue;
    }
    return null; 
}


    async function loadDoc() {

        try {
        const IP = await getIP(); // Attendere il valore IP prima di proseguire

        if (IP) {
            const response = await fetch(`http://${IP}/print_all_advices/?ApplicationKey=oqwg-dash-jkbc-phuw-qgey-bhas-dapp`);
            const data = await response.json();

            const tableBody = document.querySelector('tbody');

            Object.keys(data).forEach(key => {
                console.log(`${key}: ${data[key]}`);

                const newRow = document.createElement('tr');
                const orarioCell = document.createElement('td');

                orarioCell.textContent = key;
                newRow.appendChild(orarioCell);

                const parametroCell = document.createElement('td');
                parametroCell.textContent = data[key];

                newRow.appendChild(parametroCell);
                tableBody.appendChild(newRow);
            });
        } else {
            console.log('Valore IP non trovato nell\'localStorage.');
        }
    } catch (error) {
        console.log('Errore nel caricamento dei dati:', error);
    }
    }
    loadDoc();
</script>

<body>
<nav class="navbar bg-body-tertiary" data-bs-theme="dark">
    <div class="container">
        <a class="navbar-brand" href="#">
            <img src="ovv-Logo_3.png" alt="Bootstrap" width="30" height="24">
            OVVwebApp
        </a>
    </div>
</nav>

<table class="table">
    <thead>
        <tr>
            <th scope="col">Orario</th>
            <th scope="col">Valore</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>
<div class="d-grid gap-2">
    <button class="btn btn-primary" type="button" onclick="window.location.href='index.html';">Torna alla home</button>
</div>
</body>
</html>
